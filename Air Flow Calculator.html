<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Air Flow Conversion Calculator</title>
  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --accent:#0b74de;
      --muted:#666;
      --glass: rgba(11,116,222,0.08);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    body{margin:0;background:var(--bg);color:#111;line-height:1.4}
    .wrap{max-width:980px;margin:30px auto;padding:20px;}
    .header{display:flex;align-items:center;gap:16px}
    .logo{width:56px;height:56px;border-radius:10px;background:var(--glass);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent)}
    h1{margin:0;font-size:20px}
    p.lead{margin:6px 0 20px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:18px}
    .card{background:var(--card);border-radius:10px;padding:16px;box-shadow:0 6px 18px rgba(16,24,40,0.06)}
    .section{margin-bottom:14px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="number"], select, input[type="text"]{
      width:100%;padding:8px 10px;border:1px solid #e6e9ef;border-radius:8px;font-size:14px;
    }
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .small{font-size:13px;color:var(--muted)}
    .units{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .btn{display:inline-block;padding:8px 12px;border-radius:8px;background:var(--accent);color:#fff;font-weight:600;border:none;cursor:pointer}
    .mutebtn{background:#f2f6fb;color:var(--accent);border:1px solid #dcebf9}
    .results {display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .resitem{background:#fbfdff;padding:10px;border-radius:8px;border:1px solid #eef6ff}
    .resitem strong{display:block;font-size:16px}
    .hint{font-size:13px;color:#444;margin-top:6px}
    .foot{font-size:13px;color:var(--muted);margin-top:10px}
    @media (max-width:880px){
      .grid{grid-template-columns:1fr; }
      .results{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="logo">AF</div>
      <div>
        <h1>Air Flow Conversion Calculator</h1>
        <p class="lead">Konversi kecepatan udara dan laju volumetrik — hitung CFM dari dimensi duct atau hitung kecepatan dari CFM.</p>
      </div>
    </div>

    <div class="grid" role="main">
      <!-- left: controls -->
      <div class="card">
        <div class="section">
          <label>Masukkan nilai (isi salah satu: Velocity atau Volumetric). Jika ingin menghitung volumetrik/kecepatan dari dimensi duct, isi juga dimensi duct di bagian bawah.</label>
        </div>

        <div class="section">
          <label>Velocity (isi salah satu)</label>
          <div class="row">
            <input id="velInput" type="number" placeholder="Angka (mis. 500)" />
            <select id="velUnit">
              <option value="lfm">ft/min (LFM)</option>
              <option value="mps">m/s</option>
              <option value="mph">miles/hr (MPH)</option>
            </select>
          </div>
        </div>

        <div class="section">
          <label>Volumetric Flow (isi salah satu)</label>
          <div class="row">
            <input id="volInput" type="number" placeholder="Angka (mis. 1000)" />
            <select id="volUnit">
              <option value="cfm">ft³/min (CFM)</option>
              <option value="m3h">m³/hr</option>
              <option value="ls">L/s</option>
            </select>
          </div>
        </div>

        <hr />

        <div class="section">
          <label>Duct / Channel (opsional — isi jika ingin hitung CFM ↔ velocity)</label>
          <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
            <label class="small" style="margin:0">Tipe:</label>
            <select id="ductType" style="width:170px">
              <option value="rect">Rectangle</option>
              <option value="circ">Circular (radius)</option>
            </select>
            <select id="dimUnit" style="width:120px">
              <option value="in">in</option>
              <option value="ft">ft</option>
              <option value="mm">mm</option>
              <option value="cm">cm</option>
              <option value="m" selected>m</option>
            </select>
          </div>

          <div id="rectInputs">
            <label>H (height)</label>
            <input id="hVal" type="number" placeholder="H (mis. 0.3)" />
            <label style="margin-top:8px">W (width)</label>
            <input id="wVal" type="number" placeholder="W (mis. 0.4)" />
          </div>

          <div id="circInputs" style="display:none">
            <label>R (radius)</label>
            <input id="rVal" type="number" placeholder="Radius (mis. 0.2)" />
            <div class="small hint">Masukkan radius — unit sesuai pilihan unit dimensi di atas.</div>
          </div>
        </div>

        <div class="section" style="display:flex;gap:8px;align-items:center">
          <button id="calcBtn" class="btn">Calculate</button>
          <button id="clearBtn" class="mutebtn">Clear</button>
        </div>

        <div class="foot">Catatan: 1 ft = 0.3048 m, 1 in = 0.0254 m, 1 m³ = 1000 L.</div>
      </div>

      <!-- right: results -->
      <div class="card">
        <div class="section">
          <h3 style="margin:0 0 8px 0">Results</h3>
          <div class="results" id="resultsBox">
            <div class="resitem">
              <div class="small">Velocity</div>
              <strong id="resLfm">— ft/min (LFM)</strong>
              <div class="small" id="resMps">— m/s</div>
              <div class="small" id="resMph">— miles/hr</div>
            </div>
            <div class="resitem">
              <div class="small">Volumetric Flow</div>
              <strong id="resCfm">— ft³/min (CFM)</strong>
              <div class="small" id="resM3h">— m³/hr</div>
              <div class="small" id="resLs">— L/s</div>
            </div>
          </div>
        </div>

        <div class="section">
          <h4 style="margin:0 0 8px 0">Area & intermediate</h4>
          <div class="results">
            <div class="resitem">
              <div class="small">Cross-sectional area</div>
              <strong id="areaVal">— m²</strong>
              <div class="small" id="areaDetails"></div>
            </div>
            <div class="resitem">
              <div class="small">Notes</div>
              <div id="notes" class="small">Masukkan nilai dan klik Calculate.</div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="small">Cara pakai singkat:</div>
          <ol style="padding-left:18px;margin-top:6px">
            <li>Isi velocity (LFM/m/s/MPH) atau volumetric (CFM/m³/h/L/s).</li>
            <li>Jika ingin volumetrik ↔ velocity berdasarkan duct, isi dimensi duct + pilih unit.</li>
            <li>Klik Calculate.</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const toMeter = {
    "in": 0.0254,
    "ft": 0.3048,
    "mm": 0.001,
    "cm": 0.01,
    "m": 1
  };

  // unit conversion helpers
  function velToMps(value, unit){
    if (value === null || value === "" || isNaN(value)) return NaN;
    value = Number(value);
    if(unit === "lfm"){ // ft/min
      return value * 0.3048 / 60.0; // ft->m then per min -> per sec
    } else if(unit === "mps"){
      return value;
    } else if(unit === "mph"){
      return value * 1609.344 / 3600.0;
    }
    return NaN;
  }
  function mpsToVel(mps, unit){
    if (unit === "lfm") return mps * 60.0 / 0.3048;
    if (unit === "mps") return mps;
    if (unit === "mph") return mps * 3600.0 / 1609.344;
    return NaN;
  }

  function volToM3s(value, unit){
    if (value === null || value === "" || isNaN(value)) return NaN;
    value = Number(value);
    if(unit === "cfm"){
      // ft^3 per min -> m^3 per s
      return value * 0.028316846592 / 60.0;
    } else if(unit === "m3h"){
      return value / 3600.0;
    } else if(unit === "ls"){
      return value / 1000.0; // L/s -> m3/s
    }
    return NaN;
  }
  function m3sToVol(m3s, unit){
    if (unit === "cfm") return m3s * 60.0 / 0.028316846592;
    if (unit === "m3h") return m3s * 3600.0;
    if (unit === "ls") return m3s * 1000.0;
    return NaN;
  }

  // DOM
  const velInput = document.getElementById('velInput');
  const velUnit = document.getElementById('velUnit');
  const volInput = document.getElementById('volInput');
  const volUnit = document.getElementById('volUnit');
  const ductType = document.getElementById('ductType');
  const dimUnit = document.getElementById('dimUnit');
  const rectInputs = document.getElementById('rectInputs');
  const circInputs = document.getElementById('circInputs');
  const hVal = document.getElementById('hVal');
  const wVal = document.getElementById('wVal');
  const rVal = document.getElementById('rVal');

  const calcBtn = document.getElementById('calcBtn');
  const clearBtn = document.getElementById('clearBtn');

  // results
  const resLfm = document.getElementById('resLfm');
  const resMps = document.getElementById('resMps');
  const resMph = document.getElementById('resMph');
  const resCfm = document.getElementById('resCfm');
  const resM3h = document.getElementById('resM3h');
  const resLs = document.getElementById('resLs');
  const areaVal = document.getElementById('areaVal');
  const areaDetails = document.getElementById('areaDetails');
  const notes = document.getElementById('notes');

  ductType.addEventListener('change', (e)=>{
    if (e.target.value === 'rect'){
      rectInputs.style.display = '';
      circInputs.style.display = 'none';
    } else {
      rectInputs.style.display = 'none';
      circInputs.style.display = '';
    }
  });

  function computeArea(){
    const unit = dimUnit.value;
    const conv = toMeter[unit] || 1;
    if (ductType.value === 'rect'){
      const h = parseFloat(hVal.value);
      const w = parseFloat(wVal.value);
      if (isNaN(h) || isNaN(w)) return {area:null, detail:''};
      const area = (h * conv) * (w * conv);
      return {area: area, detail: `${h} ${unit} × ${w} ${unit} = ${(area).toExponential(6)} m²`};
    } else {
      const r = parseFloat(rVal.value);
      if (isNaN(r)) return {area:null, detail:''};
      const area = Math.PI * Math.pow(r * conv, 2);
      return {area: area, detail: `π × ${r}² ${unit}² = ${(area).toExponential(6)} m²`};
    }
  }

  function pretty(num, digits=4){
    if (num === null || isNaN(num)) return '—';
    // choose fixed or exponential based on magnitude
    if (Math.abs(num) >= 0.0001 && Math.abs(num) < 1e6){
      return Number(num.toFixed(digits)).toLocaleString();
    }
    return Number(num).toExponential(4);
  }

  calcBtn.addEventListener('click', ()=>{
    notes.textContent = '';
    // determine inputs
    const velValRaw = velInput.value.trim();
    const volValRaw = volInput.value.trim();
    const areaInfo = computeArea();
    const area = areaInfo.area; // m2 or null

    let mps = NaN;
    let m3s = NaN;
    // priority:
    // if velocity provided -> convert
    // if volumetric provided -> convert
    // if both provided -> trust volumetric? we'll use whichever is present; if both present and area present we can cross-check.
    if (velValRaw !== ''){
      mps = velToMps(Number(velValRaw), velUnit.value);
      // if area available compute volumetric
      if (!isNaN(mps) && area){
        m3s = mps * area;
      }
    }

    if (volValRaw !== ''){
      const volM3s = volToM3s(Number(volValRaw), volUnit.value);
      // If user entered volumetric and also velocity, prefer volumetric for volumetric->velocity calculation if area is present.
      if (!isNaN(volM3s)){
        m3s = volM3s;
        if (area){
          mps = m3s / area;
        }
      }
    }

    // If neither area nor values lead to both, still convert available ones across same domain
    // If only velocity given and no area -> convert velocity units
    if (!isNaN(mps) && isNaN(m3s) && !area){
      // only velocity conversions
    }
    if (!isNaN(m3s) && isNaN(mps) && !area){
      // only volumetric conversions
    }

    // populate results
    resLfm.textContent = pretty(mpsToVel(mps,"lfm")) + " ft/min (LFM)";
    resMps.textContent = pretty(mps) + " m/s";
    resMph.textContent = pretty(mpsToVel(mps,"mph")) + " miles/hr";

    resCfm.textContent = pretty(m3sToVol(m3s,"cfm")) + " ft³/min (CFM)";
    resM3h.textContent = pretty(m3sToVol(m3s,"m3h")) + " m³/hr";
    resLs.textContent = pretty(m3sToVol(m3s,"ls")) + " L/s";

    if (area != null){
      areaVal.textContent = pretty(area,6) + " m²";
      areaDetails.textContent = areaInfo.detail;
    } else {
      areaVal.textContent = '— m²';
      areaDetails.textContent = '';
    }

    // cross-check note if both velocity & volumetric provided and area present
    if (velValRaw !== '' && volValRaw !== '' && area){
      const vFromVol = (m3s / area);
      const velFromInput = velToMps(Number(velValRaw), velUnit.value);
      const relDiff = Math.abs(vFromVol - velFromInput) / (Math.abs(velFromInput) + 1e-12);
      if (relDiff > 0.01){ // >1% difference
        notes.innerHTML = "Perhatian: nilai velocity dan volumetric yang dimasukkan <strong>tidak konsisten</strong> dengan dimensi duct. Perbedaan ≈ " + (relDiff*100).toFixed(2) + "%.";
      } else {
        notes.textContent = "Input velocity dan volumetric cocok dengan dimensi duct.";
      }
    } else {
      notes.textContent = "Hasil diperbarui.";
    }
  });

  clearBtn.addEventListener('click', ()=>{
    velInput.value=''; volInput.value=''; hVal.value=''; wVal.value=''; rVal.value='';
    resLfm.textContent = '— ft/min (LFM)'; resMps.textContent = '— m/s'; resMph.textContent = '— miles/hr';
    resCfm.textContent = '— ft³/min (CFM)'; resM3h.textContent = '— m³/hr'; resLs.textContent = '— L/s';
    areaVal.textContent = '— m²'; areaDetails.textContent = ''; notes.textContent = 'Masukkan nilai dan klik Calculate.';
  });

  // small UX: pressing Enter on inputs triggers calculate
  document.querySelectorAll('input').forEach(inp=>{
    inp.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter'){ calcBtn.click(); e.preventDefault(); }
    });
  });

})();
</script>
</body>
</html>
